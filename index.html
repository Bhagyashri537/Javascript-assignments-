<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>
<div class="container">
  <form onsubmit="saveToStorage(event)" name="my-form" id="my-form" class="form-group">
    <h3 style="text-align: center; font-weight: bold;">Expense Tracker</h3>
    <div class="row jumbotron">
      <div class="col-sm-4">
        <label for="inputname">Choose Expense Amount:</label>
        <input type="number" class="form-control" id="number" name="amount" placeholder="Amount">
      </div>
      <div class="col-sm-4">
        <label for="inputname">Choose Description:</label>
        <input type="text" class="form-control" id="text1" name="description" placeholder="Description">
      </div>
      <div class="col-sm-4">
        <label for="inputname">Choose Category:</label>
        <input type="text" class="form-control" id="text2" name="category" placeholder="Category">
      </div>
      <div class="col-md-12">
         <button type="submit" class="btn-btn primary">Add Expenses</button>
      </div>
    </div>
  </form>
  <ul id="listOfExpense"></ul>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.2/axios.min.js"></script>
<script>
  function saveToStorage(event){
    event.preventDefault();
    const amount = event.target.amount.value;
    const description = event.target.description.value;
    const category = event.target.category.value;

    const obj = {
           amount,
           description,
           category
    }
   axios.post("https://crudcrud.com/api/c943751192c0463a80c52d632f59d4b6/expenseData",obj)
   .then((response) => {
    //console.log(response)
    showExpenseOnscreen(response.data)
   })
   .catch((err) => {
    console.log(err)
   })
  }
   window.addEventListener("DOMContentLoaded", () =>{
    axios.get("https://crudcrud.com/api/c943751192c0463a80c52d632f59d4b6/expenseData")
    .then((response) => {
      console.log(response)
      for(var i=0; i<response.data.length; i++){
        showExpenseOnscreen(response.data[i])
      }
    })
    .catch((err) =>{
      console.log(err)
    })
   })
  
  function showExpenseOnscreen(expense){
     const totalExpense = expense._totalAmount;
     const parentNode = document.getElementById("listOfExpense");
     const childHTML = `<li id=${expense._totalAmount}>${expense.amount}-${expense.description}-${expense.category}<button onclick=deleteExpense('${expense._totalAmount}')>Delete</button><button onclick=editExpense('${expense.amount}','${expense.description}','${expense.category}','${expense._totalAmount}')>Edit</button></li>`
     parentNode.innerHTML=parentNode.innerHTML + childHTML;
  }

  function editExpense(amount,description,category,totalExpense){
    document.getElementById('number').value = amount;
    document.getElementById('text1').value = description;
    document.getElementById('text2').value = category;
    deleteExpense(totalExpense)
  }

  function deleteExpense(totalExpense){
    axios.delete(`https://crudcrud.com/api/c943751192c0463a80c52d632f59d4b6/expenseData/${totalExpense}`)
    .then((response) => {
     // console.log(response)
      removeFromScreen(totalExpense)
    })
    .catch((err) => {
      console.log(err)
    })
  }
  function removeFromScreen(totalExpense){
    const parent = document.getElementById('listOfExpene')
    const element = document.getElementById(totalExpense)
    if(element){
      parent.removeChild(element)
    }
  }
</script>
</body>
</html>